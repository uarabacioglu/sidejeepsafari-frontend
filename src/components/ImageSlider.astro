---
const { images, title } = Astro.props;

if (!images || images.length === 0) {
	return null;
}
---

<section class="relative">
	<!-- Main Image Display -->
	<div class="relative w-full h-64 md:h-96 lg:h-[500px] rounded-xl overflow-hidden bg-gray-200 dark:bg-gray-700 mb-4">
		<div id="main-image-container" class="relative w-full h-full">
			{images.map((img: any, index: number) => (
				<div
					class={`main-slide absolute inset-0 transition-opacity duration-500 ${
						index === 0 ? 'opacity-100' : 'opacity-0'
					}`}
					data-index={index}
				>
					<img
						src={img.image}
						alt={img.alt_text || title || `Tour image ${index + 1}`}
						class="w-full h-full object-cover"
						loading={index === 0 ? 'eager' : 'lazy'}
						data-index={index}
					/>
				</div>
			))}
		</div>

		<!-- Navigation Arrows -->
		{images.length > 1 && (
			<>
				<button
					id="prev-btn"
					class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 dark:bg-gray-800/90 hover:bg-white dark:hover:bg-gray-800 text-gray-900 dark:text-white p-2 rounded-full shadow-lg transition-all z-10"
					aria-label="Previous image"
				>
					<svg
						class="w-6 h-6"
						fill="none"
						stroke="currentColor"
						viewBox="0 0 24 24"
					>
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M15 19l-7-7 7-7"
						/>
					</svg>
				</button>
				<button
					id="next-btn"
					class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 dark:bg-gray-800/90 hover:bg-white dark:hover:bg-gray-800 text-gray-900 dark:text-white p-2 rounded-full shadow-lg transition-all z-10"
					aria-label="Next image"
				>
					<svg
						class="w-6 h-6"
						fill="none"
						stroke="currentColor"
						viewBox="0 0 24 24"
					>
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M9 5l7 7-7 7"
						/>
					</svg>
				</button>
			</>
		)}

		<!-- Image Counter -->
		{images.length > 1 && (
			<div
				class="absolute bottom-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm font-medium z-10"
			>
				<span id="current-index">1</span> / {images.length}
			</div>
		)}
	</div>

	<!-- Thumbnail Navigation -->
	{images.length > 1 && (
		<div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
			{images.map((img: any, index: number) => (
				<button
					class={`thumbnail-btn flex-shrink-0 w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden border-2 transition-all ${
						index === 0
							? 'border-orange-500 dark:border-orange-400 opacity-100'
							: 'border-transparent opacity-60 hover:opacity-100'
					}`}
					data-index={index}
					aria-label={`View image ${index + 1}`}
				>
					<img
						src={img.image}
						alt={img.alt_text || title || `Thumbnail ${index + 1}`}
						class="w-full h-full object-cover"
						loading="lazy"
					/>
				</button>
			))}
		</div>
	)}
</section>

<script is:inline>
	(function () {
		const mainSlides = document.querySelectorAll('.main-slide');
		const thumbnailBtns = document.querySelectorAll('.thumbnail-btn');
		const prevBtn = document.getElementById('prev-btn');
		const nextBtn = document.getElementById('next-btn');
		const currentIndexSpan = document.getElementById('current-index');
		let currentIndex = 0;

		function showSlide(index) {
			// Update main image
			mainSlides.forEach((slide, i) => {
				if (i === index) {
					slide.classList.remove('opacity-0');
					slide.classList.add('opacity-100');
				} else {
					slide.classList.remove('opacity-100');
					slide.classList.add('opacity-0');
				}
			});

			// Update thumbnails
			thumbnailBtns.forEach((btn, i) => {
				if (i === index) {
					btn.classList.remove('border-transparent', 'opacity-60');
					btn.classList.add('border-orange-500', 'dark:border-orange-400', 'opacity-100');
				} else {
					btn.classList.remove('border-orange-500', 'dark:border-orange-400', 'opacity-100');
					btn.classList.add('border-transparent', 'opacity-60');
				}
			});

			// Update counter
			if (currentIndexSpan) {
				currentIndexSpan.textContent = index + 1;
			}

			currentIndex = index;
		}

		// Thumbnail click handlers
		thumbnailBtns.forEach((btn, index) => {
			btn.addEventListener('click', function () {
				showSlide(index);
			});
		});

		// Previous button
		if (prevBtn) {
			prevBtn.addEventListener('click', function () {
				const newIndex = currentIndex === 0 ? mainSlides.length - 1 : currentIndex - 1;
				showSlide(newIndex);
			});
		}

		// Next button
		if (nextBtn) {
			nextBtn.addEventListener('click', function () {
				const newIndex = currentIndex === mainSlides.length - 1 ? 0 : currentIndex + 1;
				showSlide(newIndex);
			});
		}

		// Keyboard navigation
		document.addEventListener('keydown', function (e) {
			if (e.key === 'ArrowLeft' && prevBtn) {
				prevBtn.click();
			} else if (e.key === 'ArrowRight' && nextBtn) {
				nextBtn.click();
			}
		});
	})();
</script>

<style>
	.scrollbar-hide {
		-ms-overflow-style: none;
		scrollbar-width: none;
	}
	.scrollbar-hide::-webkit-scrollbar {
		display: none;
	}
</style>

